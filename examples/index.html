<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"/>
    <title>Example for Dfd</title>
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="../dist/dfd.js"></script>
    <script>
      window.onload = function() {

        // dfd
        dfd()

        // error function
        .fail(function(err) {
          console.error(err);
          $('.error').show();

          setTimeout(function() { location.reload(); }, 500);
        })

        // wait
        .wait(500)

        // next function
        .then(function(cb) {
          $('#func1').show();
          cb();
        })

        // wait
        .wait(500)

        // 1/2 error
        .then(function(cb) {
          if (Math.random() < .5) {
            cb();
          } else {
            cb(new Error('exec error'));
          }
        })

        // wait
        .wait(500)

        // next function
        .then(function(cb) {
          $('#func2').show();
          cb();
        })

        // wait
        .wait(500)

        // parallel
        .then(
          function(cb) {
            setTimeout(function() {
              $('#func3').show();
              cb();
            }, Math.random() * 500);
          },
          function(cb) {
            setTimeout(function() {
              $('#func4').show();
              cb();
            }, Math.random() * 500);
          }
        )

        // wait
        .wait(500)

        // next function
        .then(function(cb) {
          $('#func5').show();
          cb();
        })

        // wait
        .wait(500)

        // next function
        .then(function(cb) {
          $('#end').show();

          setTimeout(function() { location.reload(); }, 500);
        })

        // dfd start
        .resolve();
      };
    </script>
    <style type="text/css">
    p { display: none; }
    p.error { display: none; color: red; }
    </style>
  </head>
  <body>
    <h1>Example for Dfd</h1>
    <p id="func1">func 1</p>
    <p id="func2">func 2</p>
    <p id="func3">func 3</p>
    <p id="func4">func 4</p>
    <p id="func5">func 5</p>
    <p id="end">End</p>
    <p class="error">Error</p>
  </body>
</html>
